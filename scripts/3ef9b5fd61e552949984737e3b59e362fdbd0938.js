!function(){$(function(){function design(){var a=function(){$(".navbar-collapse.in, #side-padding.in").collapse("hide"),$("#side-padding").css("height","")};$(".navbar-collapse").click("li",a),$(window).on("resize",a);var i=$(".page");i.wrapInner('<div class="col-sm-9 page-content"></div>'),$('<div class="col-sm-3"></div>').appendTo(i),i.wrapInner('<div class="page-paper"></div>'),$('<div class="film1"></div>').insertBefore($(".page-paper")),$('<div class="film2"></div>').insertAfter($(".page-paper")),$(".page-paper").scroll(function(){var a=Math.round($(this).scrollTop()/2);$(".film1, .film2").css("background-position","-"+a+"px 0");var i=Math.round($(this).scrollTop()/4),e=Math.abs((180+i)%360-180),t=Math.abs((360+i)%360-180),s=Math.abs((300+i)%360-180),n=Math.abs((400+i)%400-200),o=Math.abs((200+2*i)%400-200),r=Math.abs((200+i/2)%400-200);Modernizr.opacity?($("#side-nav").css({"background-color":"rgba("+e+", "+t+", "+s+", 0.7)"}),$(".nicescroll-rails div").css({"background-color":"rgba("+n+", "+o+", "+r+", 0.8)"})):($("#side-nav").css({"background-color":"rgb("+e+", "+t+", "+s+")"}),$(".nicescroll-rails div").css({"background-color":"rgb("+n+", "+o+", "+r+")"}))})}function navigation(){function pageAnim(){return pageCursor=pageCursor==pageAns.length-1?0:pageCursor+1,pageAns[pageCursor]}function imgAnim(){return imgCursor=imgCursor==imgAns.length-1?0:imgCursor+1,imgAns[imgCursor]}function bgImage(a){var i=$($(a).attr("data-bg")),e="undefined"!=typeof lastBackgrounds[a]&&lastBackgrounds[a]<i.length-1?lastBackgrounds[a]+1:0,t=$(".static-img");return t.length>0&&t[0].src===i[e].src&&(e=e<i.length-1?e+1:0),lastBackgrounds[a]=e,$(i[e])}function bgVideoUrl($img,func){var bandwReservRatio=1,dvStr=$img.attr("data-video");if(dvStr){var dv=eval("("+dvStr+")");bytesPS.get(function(a){for(var i=null,e=null,t=0;t<dv.urls.length;t++){(null===i||dv.urls[t].bytes<i.bytes)&&(i=dv.urls[t]);var s=bandwReservRatio*dv.urls[t].bytes/a;s<dv.sec&&(null===e||dv.urls[t].bytes>e.bytes)&&(e=dv.urls[t])}func(null===e?i.url:e.url)})}else func($img.attr("src").replace(/.jpg$/,".mp4"))}function nav(a){function i(){$(".page-paper").getNiceScroll().remove(),$(".film1, .film2").css({"background-position":"0 0"}),$.support.transition&&$(".film1, .film2").transition({"background-position":"-2016px 0"},5e3);var a=pageAnim(),i=a[0];$.support.transition&&(i.opacity=0),$hash.css(i),takeLayer($hash,"anim-page");var t;if(isIE8){var s=$("head");t=$('<style type="text/css">.page :before,.page :after{content:none !important}</style>'),s.append(t)}var n=a[1];$.support.transition&&(n.opacity=1),$hash.transition(n,duration,function(){takeLayer($hash,"static-page"),$(e+" .page-paper").niceScroll({zindex:1e5,autohidemode:!0,horizrailenabled:!1,cursoropacitymin:.6,cursoropacitymax:1,background:"transparent",cursorborder:"1px solid #fff",cursorwidth:"8px",cursorcolor:"rgb(200, 0, 0)"}),"none"!==$("nav").css("background-image")&&($("nav").css({"background-image":"none"}),Modernizr.opacity&&($sideNav.css({"background-color":"rgba(51, 51, 51,1)"}),$sideNav.transition({"background-color":sideNavBgColor},1e3))),isIE8&&t.remove()})}$("a").each(function(){$(this).parents("li").removeClass("active"),$(this).removeClass("active"),(this.href==a.href||this.href+"#"==a.href)&&($(this).parents("li").addClass("active"),$(this).addClass("active"))});var e=a.hash;if(e=e&&"#"!=e?e.replace("#!","#"):"#index",$hash=$(e),!($hash.length<1)){var t=bgImage(e);if($(".static-img").length>0&&$("nav").css({"background-image":"url(/images/fuzz.gif)"}),"none"!=t.css("display"))i();else{var s=imgAnim(),n=s[0];$.support.transition&&(n.opacity=0),adjustImageCss(t,n,function(){t.css(n);var a=s[1];$.support.transition&&(a.opacity=1),adjustImageCss(t,a,function(){takeLayer(t,"anim-img"),t.transition(a,duration,function(){adjustImageCss(t,a,function(){t.css(a)}),$("body").css("background-image","none"),Modernizr.touch||(null===BV&&(BV=new $.BigVideo,BV.init()),bgVideoUrl(t,function(a){BV.show(a,{ambient:!0});var i=BV.getPlayer(),e=!1;i.on("playing",function(){e||($(".static-img").css({display:"none"}),e=!0)}),i.on("waiting",function(){e&&console.log("waiting")})})),cleanLayer("static-page"),takeLayer(t,"static-img"),i()})})})}}}function cleanLayer(a){$("."+a).each(function(){var i=$(this);i.css({display:"none"}),i.removeClass(a)})}function toLayer(a,i){a.css({display:"block"}),a.removeClass("static-page static-img anim-page anim-img"),a.addClass(i)}function takeLayer(a,i){cleanLayer(i),toLayer(a,i)}function adjustImageCss(a,i,e){var t=new Image;t.onload=function(){var a,s,n=$(window).width(),o=$(window).height(),r=t.width,c=t.height,l=n/o,f=r/c;l>f?(a=n,s=a/f):(s=o,a=f*s),i.width=Math.round(a),i.height=Math.round(s),i["margin-top"]=0===parseInt(i.top)?Math.round((o-s)/2)+"px":"-100%"==i.top?Math.round(o-s)+"px":0,i["margin-left"]=0===parseInt(i.left)?Math.round((n-a)/2)+"px":"-100%"==i.left?Math.round(n-a)+"px":0,e(i)},t.src=a.attr("src")}var duration=800,zOff=900,zStaticImg=500,zStaticPage=600,zAnimImg=700,zAnimPage=800,isOff=!1,isPreOff=!1,pageAns=[[{left:"-100%",top:0},{left:0,top:0}],[{left:0,top:"-100%"},{left:0,top:0}],[{left:"100%",top:0},{left:0,top:0}],[{left:0,top:"100%"},{left:0,top:0}]],imgAns=[[{left:0,top:"-100%"},{left:0,top:0}],[{left:"100%",top:0},{left:0,top:0}],[{left:0,top:"100%"},{left:0,top:0}],[{left:"-100%",top:0},{left:0,top:0}]],pageCursor=0,imgCursor=0,lastBackgrounds={},BV=null,clickHash=null,$sideNav=$("#side-nav"),sideNavBgColor=$sideNav.css("background-color"),BytesPerSec=function(){var a=this;this.q=[];var i=$.cookie("bytesPerSec");this.bytesPerSec=i?i:null,null===this.bytesPerSec&&$(window).load(function(){var i=(new Date).getTime();i=(new Date).getTime(),console.log("Bandwidth testing..."),$.ajax({url:"/images/bandwidth.jpg?n="+i+"_"+Math.random(),cache:!1,success:function(e,t,s){var n=(new Date).getTime(),o=(n-i)/1e3;0==o&&(o=.001);var r=s.responseText.length;a.bytesPerSec=r/o,$.cookie("bytesPerSec",a.bytesPerSec),console.log("Bandwidth: "+(8*(a.bytesPerSec/1024/1024)).toFixed(2)+" Mb/sec ("+r+" bytes in "+o.toFixed(2)+" sec)."),a.runQ()}})}),this.get=function(a){this.q.push(a),this.runQ()},this.runQ=function(){if(null!==this.bytesPerSec){for(var a=0;a<this.q.length;a++)this.q[a](this.bytesPerSec);this.q=[]}}},bytesPS=new BytesPerSec;$("a").each(function(){this.hash&&(this.hash=this.hash.replace("#","#!"))}),nav(location),$("a").click(function(a){function i(){isPreOff=!0,$("#on").addClass("inactive"),$("#off").css({display:"none"}),$("#on").css({display:"block"}),$("body").append('<div id="off-bg" style="z-index:'+zOff+';"><i class="fa fa-smile-o fa-lg"></i></div>'),Modernizr.opacity?($("#off-bg").css({opacity:0}),$sideNav.transition({opacity:.3},200),$("#off-bg").transition({opacity:1},300,function(){$("#off-bg").css("background-image","url(/images/fuzz.gif)"),isOff=!0,isPreOff=!1,$("#on").removeClass("inactive")})):($("#off-bg").css("background-image","url(/images/fuzz.gif)"),isOff=!0,isPreOff=!1,$("#on").removeClass("inactive")),clickHash=location.hash}function e(){$("#off").addClass("inactive"),$("#off").css({display:"block"}),$("#on").css({display:"none"}),Modernizr.opacity?($sideNav.transition({opacity:1},duration/2),$("#off-bg").css("background-image","none").transition({opacity:0},duration,function(){$("#off-bg").remove(),isOff=!1,$("#off").removeClass("inactive")})):($("#off-bg").remove(),isOff=!1,$("#off").removeClass("inactive"))}if("?off=1"===this.search)isOff||i(),a.preventDefault();else if("?on=1"==this.search)isOff&&e(),a.preventDefault();else if(isPreOff)a.preventDefault();else{isOff&&e();var t=location.hash?location.href.replace(location.hash,""):location.href.replace(/#$/,""),s=this.hash?this.href.replace(this.hash,""):this.href.replace(/#$/,"");this.hash&&s==t?(nav(this),clickHash=this.hash,location.hash=this.hash,a.preventDefault()):s==t&&(nav(this),clickHash="",location.hash="",a.preventDefault())}}),$(window).on("hashchange",function(){var a="#"==location.hash?"":location.hash;a!==clickHash&&nav(location)}),$(window).on("resize",function(){$(".static-img").each(function(){$img=$(this),adjustImageCss($img,{top:0,left:0},function(a){$img.css(a)})})})}function opacityFix(){if(!Modernizr.opacity){for(var a=[["#top-nav",70],["#top-nav .navbar-toggle",80],["#top-nav .navbar-toggle:focus",20],["#top-nav li.navbar-text",80],["#side-nav",75],[".page-paper",90],[".page-content i",72],["#off-bg i",20],[".center-menu, .page-box",70]],i=$("head"),e='<style type="text/css">',t=0;t<a.length;t++)e+=a[t][0]+' {-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity='+a[t][1]+')";}';e+="</style>",i.append($(e))}}var isIE8=$("html").hasClass("ie8");$.support.transition||($.fn.transition=$.fn.animate),design(),navigation(),opacityFix()})}.call(this);